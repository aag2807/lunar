# lunar2decl - Declaration File Generator

A command-line tool to automatically generate Lunar type declaration files (`.d.lunar`) from existing Lua code.

## Installation

```bash
go build -o lunar2decl ./cmd/lunar2decl
```

## Usage

```bash
lunar2decl [options] <input.lua>
```

### Options

- `-o <file>` - Output declaration file (default: input.d.lunar)
- `--version` - Show version information
- `--help` - Show help message

### Examples

```bash
# Generate declarations for a Lua library
lunar2decl mylib.lua

# Specify custom output file
lunar2decl mylib.lua -o declarations.d.lunar

# Generate declarations for Lua standard library modules
lunar2decl /usr/share/lua/5.1/socket.lua
```

## What It Does

The tool analyzes Lua source files and extracts:

- ✅ Global function declarations
- ✅ Function parameters (converted to typed parameters)
- ✅ Handles varargs (`...`)
- ❌ Skips local functions (not exported)
- ❌ Skips module-style functions (e.g., `module.func`) - these require manual interface declarations

## Generated Output

All generated declarations use `any` type by default. You should manually refine the types for better type safety.

**Input (mylib.lua):**
```lua
function add(a, b)
    return a + b
end

function greet(name)
    return "Hello, " .. name
end
```

**Output (mylib.d.lunar):**
```lunar
-- Type declarations generated from mylib.lua
-- Generated by lunar2decl 0.1.0

declare function add(a: any, b: any): any end
declare function greet(name: any): any end
```

## Manual Refinement

After generation, manually improve the types:

```lunar
-- Type declarations generated from mylib.lua
-- Manually refined for type safety

declare function add(a: number, b: number): number end
declare function greet(name: string): string end
```

## Limitations

- **Module Functions**: Functions like `module.func()` are skipped. For module-based libraries, you should manually create interface declarations:

```lunar
declare interface MyModule {
	func: function(x: number): string
}
end

declare const mymodule: MyModule
```

- **Type Inference**: All types default to `any`. Manual refinement is required for proper type safety.

- **Complex Patterns**: Only detects simple function declarations. Doesn't handle functions assigned to variables, closures, or metatable-based OOP.

## Use Cases

- Creating type declarations for third-party Lua libraries
- Generating initial type stubs for large Lua codebases
- Documenting existing Lua APIs with type information

## See Also

- [Lunar Language Documentation](../../README.md)
- [Declaration Files Guide](../../examples/README.md)
- [Standard Library Declarations](../../stdlib/README.md)
